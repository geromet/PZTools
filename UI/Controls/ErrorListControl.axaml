<rxui:ReactiveUserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:rxui="http://reactiveui.net"
    xmlns:vm="using:UI.ViewModels"
    xmlns:errors="using:DataInput.Errors"
    x:TypeArguments="vm:ErrorListViewModel"
    x:Class="UI.Controls.ErrorListControl"
    x:DataType="vm:ErrorListViewModel">

    <Grid RowDefinitions="Auto,*">

        <!-- Toolbar -->
        <Border Grid.Row="0"
                Background="{StaticResource BgElevated}"
                BorderBrush="{StaticResource BorderSubtle}"
                BorderThickness="0 0 0 1"
                Padding="10 5">
            <DockPanel>
                <TextBlock DockPanel.Dock="Left"
                           Text="ERROR LIST"
                           FontSize="10" FontWeight="SemiBold" LetterSpacing="1.5"
                           Foreground="{StaticResource TextMuted}"
                           VerticalAlignment="Center"/>

                <!-- Error/warning counts -->
                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" Spacing="12">
                    <ToggleButton IsChecked="{Binding ShowErrors}"
                                  Padding="8 3" FontSize="11">
                        <StackPanel Orientation="Horizontal" Spacing="5">
                            <Ellipse Width="7" Height="7" VerticalAlignment="Center"
                                     Fill="{StaticResource StatusError}"/>
                            <TextBlock>
                                <Run Text="{Binding ErrorCount}"/>
                                <Run Text=" errors"/>
                            </TextBlock>
                        </StackPanel>
                    </ToggleButton>
                    <ToggleButton IsChecked="{Binding ShowWarnings}"
                                  Padding="8 3" FontSize="11">
                        <StackPanel Orientation="Horizontal" Spacing="5">
                            <Ellipse Width="7" Height="7" VerticalAlignment="Center"
                                     Fill="{StaticResource StatusWarning}"/>
                            <TextBlock>
                                <Run Text="{Binding WarningCount}"/>
                                <Run Text=" warnings"/>
                            </TextBlock>
                        </StackPanel>
                    </ToggleButton>
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- DataGrid binds to DynamicData filtered collection -->
        <DataGrid Grid.Row="1"
                  ItemsSource="{Binding FilteredErrors}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  CanUserReorderColumns="True"
                  CanUserResizeColumns="True"
                  CanUserSortColumns="True">

            <DataGrid.Columns>
                <!-- Severity dot -->
                <DataGridTemplateColumn Header="" Width="28" CanUserSort="False">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate DataType="errors:ParseError">
                            <Ellipse Width="7" Height="7"
                                     HorizontalAlignment="Center"
                                     VerticalAlignment="Center"
                                     Fill="{Binding IsFatal,
                                         Converter={x:Static BoolConverters.And},
                                         ConverterParameter={StaticResource StatusError}}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTextColumn Header="Code"    Binding="{Binding Code}"       Width="150"/>
                <DataGridTextColumn Header="Context" Binding="{Binding Context}"    Width="200"/>
                <DataGridTextColumn Header="Message" Binding="{Binding Message}"    Width="*"/>
                <DataGridTextColumn Header="File"    Binding="{Binding SourceFile}" Width="160"/>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</rxui:ReactiveUserControl>
